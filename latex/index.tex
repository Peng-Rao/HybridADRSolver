\chapter{Hybrid ADR Solver }
\hypertarget{index}{}\label{index}\index{Hybrid ADR Solver@{Hybrid ADR Solver}}
\label{index_md_README}%
\Hypertarget{index_md_README}%


\href{https://github.com/Peng-Rao/HybridADRSolver/actions/workflows/ci.yml}{\texttt{}} \href{https://github.com/Peng-Rao/HybridADRSolver/actions/workflows/pages/pages-build-deployment}{\texttt{}}

A high-\/performance finite element solver for the steady-\/state {\bfseries{Advection-\/\+Diffusion-\/\+Reaction (ADR)}} equation using the \href{https://www.dealii.org/}{\texttt{deal.\+II}} library. This project implements and compares two parallelization strategies\+:


\begin{DoxyItemize}
\item {\bfseries{Matrix-\/\+Based Solver}}\+: Explicit sparse matrix assembly with Work\+Stream threading + AMG preconditioning
\item {\bfseries{Matrix-\/\+Free Solver}}\+: On-\/the-\/fly operator evaluation with Geometric Multigrid (GMG) preconditioning
\end{DoxyItemize}

Both solvers support hybrid {\bfseries{MPI + threading}} parallelization for optimal performance on modern HPC architectures.

The complete documentation of this project code can be found here \href{https://peng-rao.github.io/HybridADRSolver/}{\texttt{docs}}.\hypertarget{index_autotoc_md1}{}\doxysection{\texorpdfstring{Features}{Features}}\label{index_autotoc_md1}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Feature  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Matrix-\/\+Based  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Matrix-\/\+Free  }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Feature  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Matrix-\/\+Based  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Matrix-\/\+Free  }\\\cline{1-3}
\endhead
Sparse Matrix Storage  &\PBS\centering ✓  &\PBS\centering ✗  \\\cline{1-3}
Thread-\/\+Parallel Assembly  &\PBS\centering Work\+Stream  &\PBS\centering FEEvaluation  \\\cline{1-3}
Preconditioner  &\PBS\centering AMG (PETSc/hypre)  &\PBS\centering GMG (Chebyshev)  \\\cline{1-3}
Memory Scaling  &\PBS\centering O(N × stencil)  &\PBS\centering O(\+N)  \\\cline{1-3}
Best For  &\PBS\centering Small-\/medium problems  &\PBS\centering Large-\/scale problems  \\\cline{1-3}
\end{longtabu}
\hypertarget{index_autotoc_md2}{}\doxysection{\texorpdfstring{Building}{Building}}\label{index_autotoc_md2}
\hypertarget{index_autotoc_md3}{}\doxysubsection{\texorpdfstring{Prerequisites}{Prerequisites}}\label{index_autotoc_md3}
We recommend using \href{https://spack.io}{\texttt{Spack}} to manage dependencies\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ Install\ Spack}
\DoxyCodeLine{git\ clone\ -\/-\/depth=2\ https://github.com/spack/spack.git}
\DoxyCodeLine{.\ spack/share/spack/setup-\/env.sh}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Install\ deal.II\ with\ required\ dependencies}
\DoxyCodeLine{spack\ install\ dealii\ +mpi\ +petsc\ +p4est\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ '\string~gmsh'\ '\string~arborx'\ '\string~taskflow'\ '\string~ginkgo'\ '\string~opencascade'\ '\string~cgal'\ '\string~trilinos'\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ '\string^petsc+hypre+metis+hdf5'\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ '\string^mpich'\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ '\string^python@3.11'}

\end{DoxyCode}
\hypertarget{index_autotoc_md4}{}\doxysubsection{\texorpdfstring{Compilation}{Compilation}}\label{index_autotoc_md4}

\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ Load\ deal.II\ environment}
\DoxyCodeLine{spack\ load\ dealii}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Build\ the\ project}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{cmake\ ..}
\DoxyCodeLine{make\ -\/j\$(nproc)}

\end{DoxyCode}
\hypertarget{index_autotoc_md5}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{index_autotoc_md5}
\hypertarget{index_autotoc_md6}{}\doxysubsection{\texorpdfstring{Running Examples}{Running Examples}}\label{index_autotoc_md6}

\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ Matrix-\/based\ solver\ (single\ process)}
\DoxyCodeLine{./main\_matrix\_based}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Matrix-\/free\ solver\ (single\ process)}
\DoxyCodeLine{./main\_matrix\_free}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Hybrid\ MPI\ +\ threading}
\DoxyCodeLine{export\ OMP\_NUM\_THREADS=4}
\DoxyCodeLine{mpirun\ -\/np\ 8\ ./main\_matrix\_free}

\end{DoxyCode}
\hypertarget{index_autotoc_md7}{}\doxysubsection{\texorpdfstring{Running Benchmarks}{Running Benchmarks}}\label{index_autotoc_md7}

\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ Time\ complexity\ study\ (refinement\ levels\ 2-\/10,\ degree\ 2)}
\DoxyCodeLine{mpirun\ -\/np\ 4\ ./main\_2d\ -\/-\/min-\/ref\ 2\ -\/-\/max-\/ref\ 10\ -\/-\/degree\ 2\ -\/-\/output\ results.csv}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Convergence\ verification}
\DoxyCodeLine{mpirun\ -\/np\ 4\ ./convergence\_study}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Scaling\ study}
\DoxyCodeLine{mpirun\ -\/np\ 16\ ./scaling\_study\ -\/-\/test\ strong}

\end{DoxyCode}
\hypertarget{index_autotoc_md8}{}\doxysubsection{\texorpdfstring{Command-\/\+Line Options}{Command-\/\+Line Options}}\label{index_autotoc_md8}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Option  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Default  }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Option  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Default  }\\\cline{1-3}
\endhead
{\ttfamily -\/-\/min-\/ref, -\/m}  &Minimum refinement level  &2  \\\cline{1-3}
{\ttfamily -\/-\/max-\/ref, -\/M}  &Maximum refinement level  &10  \\\cline{1-3}
{\ttfamily -\/-\/degree, -\/d}  &Polynomial degree  &2  \\\cline{1-3}
{\ttfamily -\/-\/output, -\/o}  &Output CSV file  &{\ttfamily complexity\+\_\+2d.\+csv}  \\\cline{1-3}
{\ttfamily -\/-\/threads, -\/t}  &Threads per MPI process  &auto  \\\cline{1-3}
\end{longtabu}
\hypertarget{index_autotoc_md9}{}\doxysubsection{\texorpdfstring{Submit PBS cluster}{Submit PBS cluster}}\label{index_autotoc_md9}

\begin{DoxyCode}{0}
\DoxyCodeLine{qsub\ submit\_benchmark\_2d.pbs}
\DoxyCodeLine{qsub\ submit\_scaling\_study.pbs}

\end{DoxyCode}
\hypertarget{index_autotoc_md10}{}\doxysection{\texorpdfstring{Performance}{Performance}}\label{index_autotoc_md10}
 
\begin{DoxyInlineImage}
\includegraphics[height=\baselineskip,keepaspectratio=true]{output1.png}%The Performance of matrix based solver
\end{DoxyInlineImage}
   

 
\begin{DoxyInlineImage}
\includegraphics[height=\baselineskip,keepaspectratio=true]{output2.png}%The Performance of matrix free solver
\end{DoxyInlineImage}
   \hypertarget{index_autotoc_md11}{}\doxysection{\texorpdfstring{References}{References}}\label{index_autotoc_md11}

\begin{DoxyItemize}
\item \href{https://www.dealii.org/current/doxygen/deal.II/index.html}{\texttt{deal.\+II Documentation}}
\item \href{https://www.dealii.org/current/doxygen/deal.II/step_37.html}{\texttt{deal.\+II Step-\/37}}
\item \href{https://www.dealii.org/current/doxygen/deal.II/step_48.html}{\texttt{deal.\+II Step-\/48}}
\item \href{https://www.dealii.org/current/doxygen/deal.II/step_69.html}{\texttt{deal.\+II Step-\/69}}
\end{DoxyItemize}\hypertarget{index_autotoc_md12}{}\doxysection{\texorpdfstring{Authors}{Authors}}\label{index_autotoc_md12}

\begin{DoxyItemize}
\item {\bfseries{Peng Rao}}
\item {\bfseries{Jiali Claudio Huang}}
\item {\bfseries{Ruiying Jiao}}
\end{DoxyItemize}

{\itshape Politecnico di Milano — M.\+Sc. in High Performance Computing}\hypertarget{index_autotoc_md13}{}\doxysection{\texorpdfstring{License}{License}}\label{index_autotoc_md13}
This project is licensed under the MIT License. 